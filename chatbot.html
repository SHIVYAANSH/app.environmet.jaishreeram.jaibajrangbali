<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chloro Chatbot</title>
  <link rel="stylesheet" href="chatbot.css">
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    .chat-float-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: #16a34a;
      color: white;
      font-size: 28px;
      padding: 12px 16px;
      border-radius: 50%;
      text-decoration: none;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      z-index: 9999;
      transition: 0.3s ease;
    }
    .chat-float-btn:hover {
      background: #15803d;
    }
    .bubble.bot {
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <!-- Top Bar with Back Button -->
  <header class="chat-navbar">
    <div class="chat-header-left">
      <a href="index.html" class="back-btn">‚Üê Dashboard</a>
    </div>
    <div class="chat-logo">üåø Chloro AI</div>
  </header>

  <!-- Chat Messages -->
  <main class="chat-body" id="chat-messages">
    <!-- Messages will be added here -->
  </main>

  <!-- Chat Input -->
  <footer class="chat-input-area">
    <input type="text" id="user-input" placeholder="Ask about water or weather..." autocomplete="off">
    <button id="send-btn">‚û§</button>
  </footer>

  <!-- JavaScript Logic -->
  <script>
    const sendBtn = document.getElementById("send-btn");
    const input = document.getElementById("user-input");
    const messages = document.getElementById("chat-messages");

    const systemInstruction = `
You are Chloro AI, a friendly and professional chatbot made by EcoSphere to spread awareness about water, weather, pollution, and climate. 

Always reply in a short to medium format ‚Äî no long paragraphs. Prefer bullets, spacing, or line breaks when listing info.

Do NOT mention you're an AI language model or any company like Google. You are only part of EcoSphere.

When asked about live data like temperature, pollution level, or humidity, respond kindly that you give only general guidance, not real-time readings.

If the user asks unrelated things, give a short, polite reply and refocus on environmental topics.
`.trim();

    sendBtn.onclick = async () => {
      const userText = input.value.trim();
      if (!userText) return;

      messages.innerHTML += `<div class="bubble user">${userText}</div>`;
      messages.innerHTML += `<div class="bubble bot typing">Typing...</div>`;
      messages.scrollTop = messages.scrollHeight;
      input.value = "";

      const res = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyAjgjaSUBx6w6CuXlyG_hrHfGbbxKW9jWs", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [
            { role: "user", parts: [{ text: systemInstruction }] },
            { role: "user", parts: [{ text: userText }] }
          ]
        })
      });

      const data = await res.json();
      document.querySelector(".typing").remove();
      let reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "‚ö†Ô∏è I didn‚Äôt understand that.";
      reply = reply.replace(/\n/g, "<br>"); // add line breaks for spacing
      messages.innerHTML += `<div class="bubble bot">${reply}</div>`;
      messages.scrollTop = messages.scrollHeight;
    };

    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendBtn.click();
    });
  </script>

</body>
</html>
